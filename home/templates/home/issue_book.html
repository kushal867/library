{% extends 'base.html' %}

{% block title %}Issue Book - Library MS{% endblock %}

{% block content %}
<div class="auth-container stagger-item">
    <h2><i class="fas fa-hand-holding-heart"></i> Issue Book</h2>
    <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Assign a book to a library member</p>
    
    <form method="post" id="issueForm">
        {% csrf_token %}
        
        {% for field in form %}
        <div class="form-group {% if field.errors %}has-error{% endif %}">
            <label for="{{ field.id_for_label }}">
                <i class="fas fa-{% if 'book' in field.name %}book{% elif 'student' in field.name or 'member' in field.name %}user{% elif 'date' in field.name %}calendar{% else %}info-circle{% endif %}"></i>
                {{ field.label }}
            </label>
            <div class="input-wrapper">
                <i class="fas fa-{% if 'book' in field.name %}book{% elif 'student' in field.name or 'member' in field.name %}user{% elif 'date' in field.name %}calendar{% else %}info-circle{% endif %} input-icon"></i>
                {% if field.field.widget.input_type == 'select' %}
                    {{ field }}
                {% else %}
                    <input 
                        type="{{ field.field.widget.input_type }}" 
                        id="{{ field.id_for_label }}" 
                        name="{{ field.name }}"
                        {% if field.field.required %}required{% endif %}
                        placeholder="{{ field.label }}"
                        class="{% if field.errors %}error{% endif %}"
                        style="padding-left: 3rem;">
                {% endif %}
            </div>
            {% if field.errors %}
                <div class="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    {{ field.errors.0 }}
                </div>
            {% endif %}
        </div>
        {% endfor %}
        
        <div style="background: rgba(79, 172, 254, 0.1); border-left: 4px solid #4facfe; padding: 1rem; border-radius: 8px; margin: 1.5rem 0;">
            <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">
                <i class="fas fa-info-circle"></i> Make sure the book is available before issuing it to a student.
            </p>
        </div>
        
        <button type="submit" id="issueButton" class="ripple glow">
            <i class="fas fa-hand-holding"></i> Issue Book
        </button>
        
        <div style="text-align: center; margin-top: 1.5rem;">
            <a href="{% url 'index' %}" style="color: var(--text-muted); text-decoration: none; font-size: 0.95rem; transition: color 0.3s;">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </form>
</div>

{% block extra_js %}
<script>
    const form = document.getElementById('issueForm');
    const submitButton = document.getElementById('issueButton');
    
    form.addEventListener('submit', function(e) {
        submitButton.classList.add('loading');
        submitButton.disabled = true;
    });
    
    // Add validation feedback
    const selects = form.querySelectorAll('select');
    const inputs = form.querySelectorAll('input');
    
    [...selects, ...inputs].forEach(element => {
        element.addEventListener('change', function() {
            const formGroup = this.closest('.form-group');
            
            if (this.value) {
                formGroup.classList.remove('has-error');  
                formGroup.classList.add('has-success');
            }
        });
    });
</script>

<style>
    .error-message {
        color: var(--danger);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: shake 0.3s ease;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
</style>
{% endblock %}
{% endblock %}
