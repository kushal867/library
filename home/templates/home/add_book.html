{% extends 'base.html' %}

{% block title %}Add Book - Library MS{% endblock %}

{% block content %}
<div class="auth-container">
    <h2><i class="fas fa-book-medical"></i> Add New Book</h2>
    <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem;">Fill in the details to add a book to your collection</p>
    
    <form method="post" id="addBookForm">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.name.id_for_label }}">
                <i class="fas fa-heading"></i> Book Title
            </label>
            <div class="input-wrapper">
                <i class="fas fa-book input-icon"></i>
                {{ form.name }}
            </div>
            {% if form.name.errors %}
                <small class="error-message"><i class="fas fa-exclamation-circle"></i> {{ form.name.errors.0 }}</small>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.author.id_for_label }}">
                <i class="fas fa-pen-fancy"></i> Author Name
            </label>
            <div class="input-wrapper">
                <i class="fas fa-user-edit input-icon"></i>
                {{ form.author }}
            </div>
            {% if form.author.errors %}
                <small class="error-message"><i class="fas fa-exclamation-circle"></i> {{ form.author.errors.0 }}</small>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.isbn.id_for_label }}">
                <i class="fas fa-barcode"></i> ISBN Number
            </label>
            <div class="input-wrapper">
                <i class="fas fa-hashtag input-icon"></i>
                {{ form.isbn }}
            </div>
            {% if form.isbn.errors %}
                <small class="error-message"><i class="fas fa-exclamation-circle"></i> {{ form.isbn.errors.0 }}</small>
            {% endif %}
            <small style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                <i class="fas fa-info-circle"></i> Enter ISBN as numbers only (e.g., 9783161484100)
            </small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.category.id_for_label }}">
                <i class="fas fa-tags"></i> Select Existing Category
            </label>
            <div class="input-wrapper">
                <i class="fas fa-layer-group input-icon"></i>
                {{ form.category }}
            </div>
            {% if form.category.errors %}
                <small class="error-message"><i class="fas fa-exclamation-circle"></i> {{ form.category.errors.0 }}</small>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.category_name.id_for_label }}">
                <i class="fas fa-plus"></i> Or Create New Category
            </label>
            <div class="input-wrapper">
                <i class="fas fa-folder-plus input-icon"></i>
                {{ form.category_name }}
            </div>
            <small style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                <i class="fas fa-lightbulb"></i> Leave blank to use selected category above
            </small>
        </div>
        
        <div class="form-group">
            <label for="{{ form.quantity.id_for_label }}">
                <i class="fas fa-sort-numeric-up"></i> Number of Copies
            </label>
            <div class="input-wrapper">
                <i class="fas fa-hashtag input-icon"></i>
                {{ form.quantity }}
            </div>
            {% if form.quantity.errors %}
                <small class="error-message"><i class="fas fa-exclamation-circle"></i> {{ form.quantity.errors.0 }}</small>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.description.id_for_label }}">
                <i class="fas fa-align-left"></i> Description (Optional)
            </label>
            {{ form.description }}
            {% if form.description.errors %}
                <small class="error-message"><i class="fas fa-exclamation-circle"></i> {{ form.description.errors.0 }}</small>
            {% endif %}
        </div>
        
        <button type="submit" id="submitButton">
            <i class="fas fa-plus-circle"></i> Add Book to Library
        </button>
        
        <div style="text-align: center; margin-top: 1.5rem;">
            <a href="{% url 'index' %}" style="color: var(--text-muted); text-decoration: none; font-size: 0.95rem; transition: color 0.3s;">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </form>
</div>

{% block extra_js %}
<script>
    const form = document.getElementById('addBookForm');
    const submitButton = document.getElementById('submitButton');
    
    form.addEventListener('submit', function(e) {
        submitButton.classList.add('loading');
        submitButton.disabled = true;
    });
    
    // Add real-time validation
    const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
    
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            const formGroup = this.closest('.form-group');
            
            if (this.value.trim() === '') {
                formGroup.classList.add('has-error');
                formGroup.classList.remove('has-success');
            } else {
                formGroup.classList.remove('has-error');
                formGroup.classList.add('has-success');
            }
        });
        
        input.addEventListener('input', function() {
            const formGroup = this.closest('.form-group');
            if (this.value.trim() !== '') {
                formGroup.classList.remove('has-error');
            }
        });
    });
    
    // ISBN Validation
    const isbnInput = document.querySelector('input[name="isbn"]');
    if (isbnInput) {
        isbnInput.addEventListener('input', function() {
            // Allow only numbers and hyphens
            this.value = this.value.replace(/[^0-9-]/g, '');
        });
    }
</script>

<style>
    .error-message {
        color: var(--danger);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: shake 0.3s ease;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
</style>
{% endblock %}
{% endblock %}
