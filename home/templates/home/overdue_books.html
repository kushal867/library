{% extends 'base.html' %}
{% load static %}

{% block title %}Overdue Books - Library MS{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-exclamation-circle text-danger"></i> Overdue Collections</h1>
    <p>Monitor and manage resources past their scheduled return date</p>
</div>

<div class="stats-grid" style="margin-bottom: 2rem;">
    <div class="card-stat" style="border-left: 5px solid var(--danger);">
        <h3>Total Overdue</h3>
        <p>{{ overdue_books|length }}</p>
    </div>
</div>

{% if overdue_books %}
<div class="table-container glass-effect">
    <table class="modern-table">
        <thead>
            <tr>
                <th style="color: var(--danger);"><i class="fas fa-book"></i> Resource</th>
                <th><i class="fas fa-user-graduate"></i> Student</th>
                <th><i class="fas fa-calendar-plus"></i> Issued</th>
                <th style="color: var(--danger);"><i class="fas fa-calendar-times"></i> Due Date</th>
                <th><i class="fas fa-clock"></i> Overdue</th>
                <th><i class="fas fa-hand-holding-usd"></i> Fine</th>
            </tr>
        </thead>
        <tbody>
            {% for issue in overdue_books %}
            <tr class="row-overdue">
                <td>
                    <div class="table-book-info">
                        <strong>{{ issue.book.name }}</strong>
                        <span class="text-muted">ISBN: {{ issue.book.isbn }}</span>
                    </div>
                </td>
                <td>
                    <div class="table-user-info">
                        <strong>{{ issue.student.user.username }}</strong>
                        <span class="text-muted">{{ issue.student.branch }} - {{ issue.student.classroom }}</span>
                    </div>
                </td>
                <td>{{ issue.issued_date|date:"M d, Y" }}</td>
                <td style="color: var(--danger); font-weight: 600;">{{ issue.expiry_date|date:"M d, Y" }}</td>
                <td>
                    <span class="status-badge badge-danger">
                        {{ issue.days_until_due|add:"-1"|add:"-" }} days
                    </span>
                </td>
                <td>
                    <strong style="color: var(--danger); font-size: 1.1rem;">${{ issue.calculate_fine }}</strong>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state glass-effect">
    <div class="success-icon" style="font-size: 4rem; color: var(--success); margin-bottom: 1.5rem;">
        <i class="fas fa-check-double"></i>
    </div>
    <h3>Excellent record!</h3>
    <p>No books are currently overdue. All students are following the schedule.</p>
    <a href="{% url 'index' %}" class="btn btn-secondary">
        <i class="fas fa-home"></i> Return to Dashboard
    </a>
</div>
{% endif %}

{% block extra_js %}
<style>
    .row-overdue {
        background: rgba(239, 68, 68, 0.03) !important;
    }
    
    .row-overdue:hover {
        background: rgba(239, 68, 68, 0.08) !important;
    }
    
    .badge-danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }
</style>
{% endblock %}
{% endblock %}
