{% extends 'base.html' %}

{% block title %}Issued Books - Library MS{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-list-alt"></i> Currently Issued Books</h1>
    <p>Track all books that have been issued to students</p>
</div>

<div class="stats-grid" style="margin-bottom: 2rem;">
    <div class="card-stat">
        <h3>Total Issued</h3>
        <p>{{ total_issued }}</p>
    </div>
</div>

{% if page_obj %}
<div class="table-container glass-effect">
    <table class="modern-table">
        <thead>
            <tr>
                <th><i class="fas fa-book"></i> Book</th>
                <th><i class="fas fa-user-graduate"></i> Student</th>
                <th><i class="fas fa-calendar-plus"></i> Issued</th>
                <th><i class="fas fa-calendar-check"></i> Due</th>
                <th><i class="fas fa-info-circle"></i> Status</th>
                <th><i class="fas fa-tasks"></i> Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for issued in page_obj %}
            <tr class="{% if issued.is_overdue %}row-overdue{% endif %}">
                <td>
                    <div class="table-book-info">
                        <strong>{{ issued.book.name }}</strong>
                        <span class="text-muted">ISBN: {{ issued.book.isbn }}</span>
                    </div>
                </td>
                <td>
                    <div class="table-user-info">
                        <strong>{{ issued.student.user.username }}</strong>
                        <span class="text-muted">{{ issued.student.branch }} - {{ issued.student.classroom }}</span>
                    </div>
                </td>
                <td>{{ issued.issued_date|date:"M d, Y" }}</td>
                <td>{{ issued.expiry_date|date:"M d, Y" }}</td>
                <td>
                    {% if issued.is_overdue %}
                        <span class="status-badge badge-danger">
                            <i class="fas fa-clock"></i> Overdue
                        </span>
                    {% else %}
                        <span class="status-badge badge-success">
                            <i class="fas fa-check"></i> On Time
                        </span>
                    {% endif %}
                </td>
                <td>
                    <div class="table-actions">
                        <form method="post" action="{% url 'return_book' %}" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="issued_book" value="{{ issued.id }}">
                            <button type="submit" class="action-btn btn-success ripple" title="Return Book">
                                <i class="fas fa-undo"></i>
                            </button>
                        </form>
                        <form method="post" action="{% url 'renew_book' issued.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn btn-warning ripple" title="Renew Book">
                                <i class="fas fa-redo"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if page_obj.has_other_pages %}
<div class="pagination-container">
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="page-btn"><i class="fas fa-chevron-left"></i></a>
        {% endif %}
        
        <span class="page-info">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="page-btn"><i class="fas fa-chevron-right"></i></a>
        {% endif %}
    </div>
</div>
{% endif %}
{% else %}
<div class="empty-state glass-effect">
    <i class="fas fa-clipboard-check"></i>
    <h3>No books currently issued</h3>
    <p>Success! All books are back in their shelves.</p>
    <a href="{% url 'issue_book' %}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Issue a New Book
    </a>
</div>
{% endif %}

{% block extra_js %}
<style>
    .table-container table th,
    .table-container table td {
        padding: 1rem;
        text-align: left;
    }
    
    .table-container table th {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(240, 147, 251, 0.1));
        font-weight: 600;
    }
    
    .table-container table tbody tr:hover {
        background-color: rgba(240, 147, 251, 0.05);
    }
</style>
{% endblock %}

{% endblock %}
